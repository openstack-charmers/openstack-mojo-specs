series: xenial
services:
  ceilometer:
    charm: ceilometer
  ceph-mon:
    charm: ceph-mon
  ceph-osd:
    charm: ceph-osd
  cinder:
    charm: cinder
  glance:
    charm: glance
  gnocchi:
    charm: gnocchi
  keystone:
    charm: keystone
  memcached:
    charm: memcached
  mongodb:
    charm: mongodb
  mysql:
    charm: mysql
  neutron-api:
    charm: neutron-api
  neutron-gateway:
    charm: neutron-gateway
  nova-cloud-controller:
    charm: nova-cloud-controller
  nova-compute:
    charm: nova-compute
  ceilometer-agent:
    charm: ceilometer-agent
  neutron-openvswitch:
    charm: neutron-openvswitch
  openstack-dashboard:
    charm: openstack-dashboard
  rabbitmq-server:
    charm: rabbitmq-server
  swift-proxy:
    charm: swift-proxy
  swift-storage-z1:
    charm: swift-storage-z1
  swift-storage-z2:
    charm: swift-storage-z2
  swift-storage-z3:
    charm: swift-storage-z3
#### mon stack
  kibana:
    charm: cs:~ivoks/kibana
    num_units: 1
  elasticsearch:
    charm: cs:elasticsearch
    num_units: 2
    options:
      firewall_enabled: False
  filebeat:
    charm: cs:xenial/filebeat
  nagios:
    charm: cs:xenial/nagios
    num_units: 1
  nrpe:
    charm: cs:xenial/nrpe
    options:
      nagios_hostname_type: "host"
      sub_postfix: ""
  prometheus:
    charm: cs:~prometheus-charmers/prometheus
    options:
      install_method: apt
    num_units: 1
  grafana:
    charm: cs:~prometheus-charmers/grafana
    options:
      port: "3000"  # XXX: bug 1752960
    num_units: 1
  telegraf:
    charm: cs:~telegraf-charmers/telegraf
  telegraf-prometheus:
    charm: cs:~telegraf-charmers/telegraf
  lldpd:
    charm: cs:~ivoks/lldpd
    options:
      interfaces-regex: 'en*'
relations:
  # openstack
  - [ nova-compute, lldpd ]
  - [ neutron-gateway, lldpd ]
  - [ nova-compute, filebeat ]
  - [ nova-compute, nrpe ]
  - [ nova-compute, telegraf ]
  - [ neutron-gateway, filebeat ]
  - [ neutron-gateway, nrpe ]
  - [ neutron-gateway, telegraf ]
  - [ ceph-mon, nrpe ]
  - [ ceph-mon, telegraf ]
  - [ ceph-radosgw, filebeat ]
  - [ ceph-radosgw, nrpe ]
  - [ ceph-radosgw, telegraf ]
  - [ cinder, filebeat ]
  - [ cinder, nrpe ]
  - [ cinder, telegraf ]
  - [ glance, filebeat ]
  - [ glance, nrpe ]
  - [ glance, telegraf ]
  - [ keystone, filebeat ]
  - [ keystone, nrpe ]
  - [ keystone, telegraf ]
  - [ mongodb, filebeat ]
  - [ mongodb, nrpe ]
  - [ mongodb, telegraf ]
  - [ mysql, filebeat ]
  - [ mysql, nrpe ]
  - [ mysql, telegraf ]
  - [ neutron-api, filebeat ]
  - [ neutron-api, nrpe ]
  - [ neutron-api, telegraf ]
  - [ nova-cloud-controller, filebeat ]
  - [ nova-cloud-controller, nrpe ]
  - [ nova-cloud-controller, telegraf ]
  - [ openstack-dashboard, filebeat ]
  - [ openstack-dashboard, nrpe ]
  - [ openstack-dashboard, telegraf ]
  - [ rabbitmq-server, filebeat ]
  - [ rabbitmq-server, nrpe ]
  - [ rabbitmq-server, telegraf ]
  - [ ceilometer, filebeat ]
  - [ ceilometer, nrpe ]
  - [ ceilometer, telegraf ]
  - [ kibana, filebeat ]
  - [ kibana, nrpe ]
  - [ kibana, telegraf ]
  - [ elasticsearch, filebeat ]
  - [ elasticsearch, nrpe ]
  - [ elasticsearch, telegraf ]
  - [ "nagios:juju-info", "filebeat:beats-host" ]
  - [ "nagios:juju-info", "telegraf:juju-info" ]
  - [ prometheus, filebeat ]
  - [ prometheus, nrpe ]
  - [ "prometheus:juju-info", "telegraf-prometheus:juju-info" ]
  - [ grafana, filebeat ]
  - [ grafana, nrpe ]
  - [ grafana, telegraf ]
  - [ nagios, nrpe ]
  - [ elasticsearch, kibana ]
  - [ "prometheus:target", "telegraf:prometheus-client" ]
  - [ "prometheus:target", "telegraf-prometheus:prometheus-client" ]
  - [ "prometheus:grafana-source", "grafana:grafana-source" ]
